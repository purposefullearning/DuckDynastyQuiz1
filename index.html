<!DOCTYPE html>
<html>
<head>
    <title>Duck Dynasty Quiz</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #2e7d32; }
        p { font-size: 16px; margin: 10px 0; }
        input { margin-right: 10px; }
        #result { font-weight: bold; margin-top: 20px; }
        #missed { color: #ff4500; }
        #leaderboard { margin-top: 20px; }
        .correct { color: green; }
        .wrong { color: red; }
    </style>
    <!-- Firebase ES Modules -->
    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js';
        import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from 'https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js';

        // Your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyA3VYfYO-MIqPt3tEtIzaleLhxfNzGsQ4o",
            authDomain: "duckdynastyquiz.firebaseapp.com",
            projectId: "duckdynastyquiz",
            storageBucket: "duckdynastyquiz.firebasestorage.app",
            messagingSenderId: "60380424217",
            appId: "1:60380424217:web:e6ea55c734a4f81907e288",
            measurementId: "G-1P9SPRKC5K"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const answers = ["A", "C", "B", "B", "B", "C", "B", "B", "B", "C", "A", "A", "B", "B"];
        const questions = [
            "What is the name of the family business featured in Duck Dynasty?",
            "Which Robertson family member is known for his wild stories and iced tea obsession?",
            "In what state does the Robertson family live?",
            "What ZZ Top song is used as the theme for Duck Dynasty?",
            "What did Phil Robertson invent that started the Duck Commander empire?",
            "Which brother is the CEO of Duck Commander?",
            "What does Uncle Si call almost everyone he meets?",
            "What sport did Phil Robertson play in college before turning down an NFL career?",
            "What unusual item did Si win in a raffle at the donut shop?",
            "Which family member released a cookbook called 'Miss Kay’s Duck Commander Kitchen'?",
            "What did Willie accidentally hit Korie with while training for a family football game?",
            "What did the Duck Commander employees build to celebrate the company’s 40th anniversary?",
            "Which country did Willie take the family to after landing a client for duck calls?",
            "What does the show typically end with the family doing?"
        ];

        function calculateScore() {
            let score = 0;
            let missed = [];
            for (let i = 0; i < 14; i++) {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                if (selected) {
                    if (selected.value === answers[i]) {
                        score++;
                    } else {
                        missed.push({
                            question: questions[i],
                            yourAnswer: selected.value,
                            correctAnswer: answers[i]
                        });
                    }
                } else {
                    // Treat unanswered questions as misses
                    missed.push({
                        question: questions[i],
                        yourAnswer: "Unanswered",
                        correctAnswer: answers[i]
                    });
                }
            }
            const percentage = (score / 14) * 100;
            let name = document.getElementById("playerName").value.trim();
            if (!name) {
                alert("Please enter your name before submitting!");
                return;
            }
            let message = `Score: ${score}/14 (${percentage.toFixed(2)}%) - Share with #DuckDynastyQuiz!`;
            if (percentage === 100) message += " Perfect score, Jack!";
            else if (percentage >= 80) message += " Hot dang, you’re a pro!";
            else if (percentage >= 50) message += " Not bad, partner!";
            else message += " Time to rewatch, buddy!";
            message += ` <a href="https://www.facebook.com/sharer/sharer.php?u=https://tvbuzznow.com/duck-dynasty-quiz-1/&e=I scored ${score}/14 on the Duck Dynasty Quiz! Beat me, Jack!" target="_blank">Share on Facebook</a>`;
            document.getElementById("result").innerHTML = message;

            // Show missed questions (including unanswered ones)
            let missedHtml = "<h3>Missed Questions:</h3>";
            if (missed.length > 0) {
                missed.forEach(m => {
                    missedHtml += `<p><span class="wrong">Q: ${m.question}</span><br>Your answer: ${m.yourAnswer} | Correct: ${m.correctAnswer}</p>`;
                });
            } else {
                missedHtml += "<p class='correct'>None! You got them all right!</p>";
            }
            document.getElementById("missed").innerHTML = missedHtml;

            // Update global leaderboard
            addDoc(collection(db, "leaderboard"), {
                name: name,
                score: score,
                timestamp: new Date().toISOString() // Simplified for module syntax
            }).then(() => updateLeaderboard());
        }

        function resetQuiz() {
            document.getElementById("quizForm").reset();
            document.getElementById("result").innerHTML = "";
            document.getElementById("missed").innerHTML = "";
        }

        async function updateLeaderboard() {
            const q = query(collection(db, "leaderboard"), orderBy("score", "desc"), limit(5));
            const querySnapshot = await getDocs(q);
            const list = document.getElementById("leaderboardList");
            list.innerHTML = "";
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const li = document.createElement("li");
                li.textContent = `${data.name}: ${data.score}/14`;
                list.appendChild(li);
            });
        }

        document.getElementById("fbShareBtn").addEventListener("click", function() {
            let score = document.getElementById("result").textContent.match(/Score: (\d+)\/14/);
            if (score) {
                score = score[1];
                window.open(`https://www.facebook.com/sharer/sharer.php?u=https://tvbuzznow.com/duck-dynasty-quiz-1/&e=I scored ${score}/14 on the Duck Dynasty Quiz! Beat me, Jack!`, '_blank');
            } else {
                alert("Please submit the quiz first to share your score!");
            }
...